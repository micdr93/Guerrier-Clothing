<div class="mb-3 text-end">
    <select id="sort-selector" class="form-select form-select-sm w-auto d-inline-block">
      <option value="reset" {% if current_sorting == 'None_None' %}selected{% endif %}>Sort by...</option>
      <option value="price_asc" {% if current_sorting == 'price_asc' %}selected{% endif %}>Price (low to high)</option>
      <option value="price_desc" {% if current_sorting == 'price_desc' %}selected{% endif %}>Price (high to low)</option>
      <option value="name_asc" {% if current_sorting == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
      <option value="name_desc" {% if current_sorting == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
    </select>
  </div>
  
  <button class="btn btn-primary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#filterCollapse" aria-expanded="false" aria-controls="filterCollapse">
    Filters
  </button>
  <div class="collapse" id="filterCollapse">
    <div class="card card-body mb-4">
      <form method="GET" action="">
        <div class="mb-3">
          <label for="price_min" class="form-label">Min Price (€)</label>
          <input type="number" name="price_min" id="price_min" class="form-control" value="{{ current_price_min|default:'' }}">
        </div>
        <div class="mb-3">
          <label for="price_max" class="form-label">Max Price (€)</label>
          <input type="number" name="price_max" id="price_max" class="form-control" value="{{ current_price_max|default:'' }}">
        </div>
        <div class="mb-3">
          <label for="category" class="form-label">Category</label>
          <select name="category" id="category" class="form-select">
            <option value="">All Categories</option>
            {% for cat in categories %}
              <option value="{{ cat.name }}" {% if cat.name == current_categories %}selected{% endif %}>{{ cat.friendly_name|default:cat.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-primary">Apply Filters</button>
          <a href="{{ request.path }}" class="btn btn-outline-secondary">Clear Filters</a>
        </div>
      </form>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const sortSelector = document.getElementById('sort-selector');
      if (sortSelector) {
        sortSelector.addEventListener('change', function() {
          const selectedVal = sortSelector.value;
          const currentUrl = new URL(window.location.href);
          if(selectedVal !== "reset"){
            const parts = selectedVal.split("_");
            currentUrl.searchParams.set("sort", parts[0]);
            currentUrl.searchParams.set("direction", parts[1]);
          } else {
            currentUrl.searchParams.delete("sort");
            currentUrl.searchParams.delete("direction");
          }
          window.location.href = currentUrl.toString();
        });
      }
    });
  </script>
  